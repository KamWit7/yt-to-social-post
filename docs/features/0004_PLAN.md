# Plan techniczny: Dodanie selektora języka w zakładce "cel"

## Kontekst

Użytkownik chce dodać selektor języka w zakładce "cel" formularza, który będzie zawierał opcje języka polskiego i angielskiego, z domyślnie zaznaczonym językiem polskim. Język ma być wysyłany do endpointu AI, który korzysta z tego formularza. Wymagane są zmiany zarówno na frontendzie jak i backendzie, włączając w to typowanie.

## Pliki do zmiany

### Backend

- `backend/src/constants/dictionaries.ts` - dodanie stałych języków
- `backend/src/services/dictionary.service.ts` - obsługa kodu 'language' w serwisie słownika
- `backend/src/controllers/dictionary.controller.ts` - dodanie mapowania dla 'language'
- `backend/src/validations/dictionary.validations.ts` - dodanie 'language' do dozwolonych kodów
- `backend/src/validations/ai.validations.ts` - dodanie pola language do schematu
- `backend/src/services/ai-processing.service.ts` - obsługa języka w serwisie
- `backend/src/controllers/ai.controller.ts` - przekazanie języka do serwisu
- `backend/src/types/ai.types.ts` - aktualizacja typów (jeśli istnieje)

### Frontend

- `yt-scribe/src/types/index.ts` - dodanie pola language do AIProcessingRequest
- `yt-scribe/src/components/dashboard/TranscriptionForms/constants/formConstants.ts` - dodanie stałej LANGUAGE
- `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/purposeSchema.ts` - dodanie walidacji języka
- `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.helpers.ts` - dodanie domyślnej wartości języka
- `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.tsx` - dodanie selektora języka

## Szczegóły implementacji

### Backend - Dodanie stałych języków

W `backend/src/constants/dictionaries.ts`:

- Dodanie stałej `Language` z wartościami `Polish: 'pl'` i `English: 'en'`
- Dodanie `Language` do eksportu `Dictionary`
- Dodanie `LanguageItems` z polskimi i angielskimi etykietami
- Dodanie `Language` do `DictionaryDisplay`

### Backend - Aktualizacja serwisu słownika

W `backend/src/services/dictionary.service.ts`:

- Dodanie obsługi kodu `'language'` w `DictionaryCode`
- Aktualizacja `DictionaryController` aby obsługiwał `code: 'language'`
- Dodanie mapowania `language: 'Language'` w kontrolerze

### Backend - Aktualizacja walidacji

W `backend/src/validations/ai.validations.ts`:

- Dodanie pola `language: z.enum(['pl', 'en']).default('pl')` do `ProcessTranscriptRequestSchema`
- Aktualizacja typu `ProcessTranscriptRequest`

### Backend - Aktualizacja serwisu

W `backend/src/services/ai-processing.service.ts`:

- Dodanie parametru `language` do metody `processTranscript`
- Przekazanie języka do metod generowania AI (jeśli potrzebne dla promptów)

### Backend - Aktualizacja kontrolera

W `backend/src/controllers/ai.controller.ts`:

- Destrukturyzacja `language` z `req.body`
- Przekazanie `language` do serwisu

### Frontend - Aktualizacja typów

W `yt-scribe/src/types/index.ts`:

- Dodanie pola `language: 'pl' | 'en'` do interfejsu `AIProcessingRequest`

### Frontend - Aktualizacja stałych

W `yt-scribe/src/components/dashboard/TranscriptionForms/constants/formConstants.ts`:

- Dodanie `LANGUAGE: 'language'` do `FORM_FIELD_NAMES`
- Dodanie `language: 'pl'` do `DEFAULT_VALUES`

### Frontend - Pobieranie opcji języków z API

W `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.tsx`:

- Dodanie hooka `useDictionary('language')` do pobierania opcji języków z backendu
- Mapowanie odpowiedzi API na format `{ label, value }` dla `ControlledSelect`
- Zastąpienie statycznych opcji języków dynamicznymi danymi z API

### Frontend - Aktualizacja walidacji

W `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/purposeSchema.ts`:

- Dodanie pola `language: z.enum(['pl', 'en']).default('pl')` do schematu

### Frontend - Aktualizacja domyślnych wartości

W `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.helpers.ts`:

- Dodanie `language: 'pl'` do `PurposeDefaultValue`

### Frontend - Dodanie selektora języka

W `yt-scribe/src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.tsx`:

- Dodanie `ControlledSelect` dla języka z dynamicznymi opcjami z API
- Umieszczenie selektora w siatce obok istniejących pól (purpose i model)
- Ustawienie domyślnej wartości na 'pl'
- Wykorzystanie `useDictionary('language')` do pobrania dostępnych języków

## Algorytm implementacji

1. **Faza 1 - Backend (warstwa danych)**

   - Dodanie stałych języków w `dictionaries.ts`
   - Aktualizacja serwisu słownika do obsługi kodu 'language'
   - Aktualizacja kontrolera słownika do mapowania 'language'
   - Aktualizacja typów i walidacji w `ai.validations.ts`
   - Aktualizacja serwisu AI do obsługi języka

2. **Faza 2 - Frontend (typowanie i stałe)**

   - Aktualizacja typów w `types/index.ts`
   - Dodanie stałych w `formConstants.ts`
   - Aktualizacja schematu walidacji
   - Implementacja pobierania opcji języków z API

3. **Faza 3 - Frontend (UI)**
   - Dodanie selektora języka w formularzu
   - Integracja z react-hook-form
   - Testowanie funkcjonalności

## Uwagi techniczne

- Język polski ('pl') jest domyślnie zaznaczony
- Selektor języka jest umieszczony w tej samej linii co purpose i model
- Wartość języka jest wysyłana do endpointu AI w każdym żądaniu
- Backend może wykorzystać język do generowania odpowiedzi w odpowiednim języku
- Wszystkie zmiany zachowują istniejącą funkcjonalność formularza
- Opcje języków są pobierane dynamicznie z API endpointu `/api/dictionary?code=language`
- Wykorzystanie istniejącego hooka `useDictionary` do pobierania danych języków
