# Feature Plan: Ograniczenie Wyboru Modelu AI dla Użytkowników bez BYOK

## Opis

Ograniczyć możliwość wyboru modeli AI tylko dla użytkowników z kontem BYOK. Użytkownicy z kontem darmowym (free) mogą używać wyłącznie modelu Gemini25Flash. Inne modele (Gemini25Pro, Gemini25FlashLite) będą zablokowane z tooltipem informującym o konieczności zmiany typu konta na BYOK w ustawieniach.

## Pliki do Modyfikacji

### 1. PurposeForm Component (`src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.tsx`)

**Zmiany:**

- Import `useSession` z `next-auth/react` do pobrania sesji użytkownika
- Import `getUserUsageStats` z `@/lib/actions/usage` do pobrania accountTier
- Dodanie stanu lokalnego do przechowywania accountTier użytkownika
- Użycie `useEffect` do pobrania accountTier przy montowaniu komponentu
- Modyfikacja sekcji wyboru modelu AI (linie 149-171):
  - Owinąć każdą opcję modelu (oprócz Gemini25Flash) w komponent Tooltip z shadcn/ui
  - Dla użytkowników z accountTier === 'free': wyłączyć opcje Gemini25Pro
  - Dla użytkowników z accountTier === 'BYOK': nie pokazywać tooltipa, wszystkie modele dostępne
  - Tooltip powinien zawierać tekst: "Aby skorzystać z tego modelu, zmień typ konta na BYOK w ustawieniach"
  - Link w tooltipie powinien prowadzić do `/settings` (ROUTES.SETTINGS)

**Algorytm:**

1. Na montowaniu komponentu, sprawdź czy session istnieje używając `useSession()`
2. Jeśli session.user.id istnieje, wywołaj `getUserUsageStats()`
3. Zapisz `accountTier` ze zwróconego obiektu stats.usage.accountTier w stanie lokalnym
4. Przy renderowaniu opcji modelu AI:
   - Gemini25Flash: zawsze dostępny bez żadnych ograniczeń
   - Gemini25Pro i Gemini25FlashLite:
     - Jeśli accountTier === 'free': disabled={true} i owinięty w Tooltip
     - Jeśli accountTier === 'BYOK': disabled={false} i bez Tooltipa

### 2. AccountDetails Component (`src/components/auth/UserProfile/components/AccountDetails.tsx`)

**Zmiany:**

- Dodać nowy wiersz informacyjny w komponencie DetailRow
- Nowy wiersz powinien wyświetlać informację: "Model AI" z wartością:
  - Dla accountTier === 'free': "Gemini 2.5 Flash (Tylko ten model)"
  - Dla accountTier === 'BYOK': "Wszystkie modele dostępne"
- Można wykorzystać istniejącą strukturę DetailRow (linie 17-25)
- Dodać nowy DetailRow po wierszu "Typ konta" (po linii 40)

### 3. Nowy Helper dla PurposeForm (`src/components/dashboard/TranscriptionForms/forms/PurposeForm/PurposeForm.helpers.ts`)

**Zmiany (lub stworzenie nowej funkcji w istniejącym pliku):**

- Dodać funkcję `isModelAvailable(model: string, accountTier: AccountTier): boolean`
  - Zwraca `true` jeśli model === AIModels.Gemini25Flash (zawsze dostępny)
  - Zwraca `true` jeśli accountTier === AccountTier.BYOK (wszystkie modele dostępne)
  - Zwraca `false` w innych przypadkach

### 4. Komponenty Shadcn/UI

**Wymagany komponent:**

- Tooltip z shadcn/ui - już istnieje w `src/components/ui/tooltip.tsx`
- Import potrzebnych komponentów:
  - `Tooltip`
  - `TooltipContent`
  - `TooltipProvider`
  - `TooltipTrigger`

### 5. Types i Constants

**Pliki do sprawdzenia/użycia:**

- `@prisma/client` - AccountTier enum (wartości: 'free', 'BYOK')
- `src/components/dashboard/TranscriptionForms/forms/Form.constants.ts` - AIModels enum
- `@/utils/constants` - ROUTES.SETTINGS

## Szczegóły Implementacji

### Warunkowa Logika dla Modeli AI

```typescript
// Pseudokod dla PurposeForm.tsx
const { data: session } = useSession()
const [accountTier, setAccountTier] = useState<AccountTier>(AccountTier.free)
const [isLoadingTier, setIsLoadingTier] = useState(true)

useEffect(() => {
  async function fetchUserTier() {
    if (!session?.user?.id) return

    try {
      const stats = await getUserUsageStats()
      if (stats.success) {
        setAccountTier(stats.usage.accountTier)
      }
    } finally {
      setIsLoadingTier(false)
    }
  }

  fetchUserTier()
}, [session?.user?.id])

// Przy renderowaniu opcji:
const isByokUser = accountTier === AccountTier.BYOK
const modelOptions = [
  {
    label: AIModels.Gemini25Pro,
    value: AIModels.Gemini25Pro,
    disabled: !isByokUser,
    requiresByok: true,
  },
  {
    label: AIModels.Gemini25Flash,
    value: AIModels.Gemini25Flash,
    disabled: false,
    requiresByok: false,
  },
  {
    label: AIModels.Gemini25FlashLite,
    value: AIModels.Gemini25FlashLite,
    disabled: !isByokUser,
    requiresByok: true,
  },
]

// Każda opcja może być owinięta warunkowo w Tooltip
```

### Struktura Tooltipa

```typescript
// Dla modeli wymagających BYOK gdy użytkownik ma free tier:
<TooltipProvider>
  <Tooltip>
    <TooltipTrigger asChild>
      <div className="cursor-not-allowed">
        <ControlledSelect option={...} disabled={true} />
      </div>
    </TooltipTrigger>
    <TooltipContent>
      <p>Aby skorzystać z tego modelu, zmień typ konta na BYOK w <Link href={ROUTES.SETTINGS}>ustawieniach</Link></p>
    </TooltipContent>
  </Tooltip>
</TooltipProvider>
```

## Weryfikacja Działania

1. Użytkownik z accountTier === 'free':

   - Widzi tylko Gemini25Flash jako aktywną opcję
   - Gemini25Pro i Gemini25FlashLite są wyłączone (disabled)
   - Po najechaniu na wyłączone opcje widzi tooltip z informacją o BYOK
   - W profilu widzi "Model AI: Gemini 2.5 Flash (Tylko ten model)"

2. Użytkownik z accountTier === 'BYOK':

   - Widzi wszystkie 3 modele jako aktywne opcje
   - Nie widzi żadnych tooltipów przy opcjach modeli
   - W profilu widzi "Model AI: Wszystkie modele dostępne"

3. Domyślny model (Gemini25Flash) zawsze jest dostępny dla wszystkich użytkowników
