# Plan: Authentication Gate for AI Processing (Purpose Form)

## Opis

Implementacja mechanizmu autoryzacji dla kroku DASHBOARD_TABS.PURPOSE, który wymaga od niezalogowanych użytkowników zalogowania się lub rejestracji przed uzyskaniem dostępu do funkcji AI. Niezalogowani użytkownicy zobaczą komunikat z przyciskami logowania/rejestracji zamiast formularza PurposeForm.

## Pliki do zmiany/utworzenia

### Nowe pliki:

1. **`src/components/dashboard/TranscriptionForms/forms/AuthGate/AuthGate.tsx`**

   - Nowy komponent wyświetlający komunikat o konieczności logowania
   - Podobny styl do success message w RegisterForm (ikona, animacja, gradient)
   - Przyciski "Zaloguj się" i "Zarejestruj się"
   - Używa useSession() do sprawdzania statusu autoryzacji

2. **`src/components/dashboard/TranscriptionForms/forms/AuthGate/index.ts`**
   - Export komponentu AuthGate

### Pliki do modyfikacji:

3. **`src/components/dashboard/TranscriptionForms/TranscriptionForms.tsx`**

   - Dodanie importu useSession z next-auth/react
   - Dodanie importu AuthGate
   - Modyfikacja logiki renderowania dla DASHBOARD_TABS.PURPOSE:
     - Jeśli użytkownik niezalogowany: renderuj AuthGate
     - Jeśli użytkownik zalogowany: renderuj PurposeForm

4. **`src/components/auth/LoginForm/components/GoogleAuth.tsx`**

   - Usunięcie callbackUrl z signIn('google', { callbackUrl: ROUTES.DASHBOARD })
   - Zmiana na signIn('google') bez callbackUrl

5. **`src/components/auth/RegisterForm/RegisterForm.tsx`**
   - Sprawdzenie czy GoogleAuth jest używany w RegisterForm
   - Jeśli tak, usunięcie callbackUrl analogicznie do LoginForm

## Algorytm działania

### AuthGate Component:

1. Sprawdza status sesji za pomocą useSession()
2. Jeśli status === 'loading': wyświetla loading spinner
3. Jeśli session?.user istnieje: renderuje children (PurposeForm)
4. Jeśli brak sesji: wyświetla komunikat autoryzacji z przyciskami

### TranscriptionForms Logic:

1. W przypadku DASHBOARD_TABS.PURPOSE:
   ```
   if (stepKey === DASHBOARD_TABS.PURPOSE) {
     return (
       <AuthGate>
         <PurposeForm {...props} />
       </AuthGate>
     )
   }
   ```

### Komunikat autoryzacji:

- Ikona z animacją (podobnie jak UserPlus w RegisterForm)
- Tytuł: "Dostęp do AI wymaga logowania"
- Opis: "Aby skorzystać z funkcji przetwarzania AI, musisz się zalogować lub utworzyć konto"
- Przycisk "Zaloguj się" (Link do ROUTES.LOGIN)
- Przycisk "Zarejestruj się" (Link do ROUTES.REGISTER)
- Gradient background podobny do RegisterForm success state

### Zachowanie po logowaniu:

- Po udanym logowaniu użytkownik zostaje na tym samym kroku (PURPOSE)
- AuthGate automatycznie wykrywa zmianę sesji i renderuje PurposeForm
- Brak callbackUrl w GoogleAuth oznacza, że użytkownik zostanie przekierowany na stronę główną, ale stan aplikacji zostanie zachowany

## Szczegóły implementacyjne

### AuthGate Props:

```typescript
interface AuthGateProps {
  children: React.ReactNode
}
```

### Zmiany w TranscriptionForms:

- Dodanie `import { useSession } from 'next-auth/react'` (opcjonalnie, jeśli potrzebne)
- Import AuthGate
- Owinięcie PurposeForm w AuthGate

### Styl komunikatu:

- Użycie klas CSS z RegisterForm success message
- Ikona: Lock lub Shield z lucide-react
- Animacja pulse dla ikony
- Gradient background: `bg-gradient-to-br from-blue-100 to-blue-50`
- Przyciski z odpowiednimi wariantami (primary dla rejestracji, ghost dla logowania)

### Usunięcie callbackUrl:

- W GoogleAuth.tsx: zmiana `signIn('google', { callbackUrl: ROUTES.DASHBOARD })` na `signIn('google')`
- Sprawdzenie czy RegisterForm używa GoogleAuth i analogiczna zmiana
